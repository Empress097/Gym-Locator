{% extends 'base.html' %}
{% load static %}
{% block content %}
<div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>
<div class="container-fluid position-relative p-0">
    <div class="container-fluid bg-primary py-5 mb-5 hero-header">
        <div class="container-fluid">
            <div class="row py-2">
                 <div class="col-sm-4 pt-lg-4 mt-lg-4">
                     <div class="container-fluid bg-white " style="border-radius: 10px;">
                         <div class="row justify-content-center py-2 mb-2 ">
                             <div class="col">
                                 <div class="position-relative w-100 mt-3">
                                     <input class="form-control border border-1 w-100 rounded-pill py-3 ps-4 pe-5" type="text" placeholder="Search for...">
                                     <button type="button" class="btn btn-primary py-2 position-absolute rounded-pill top-0 end-0 me-2" style="margin-top: 7px;"><i class="bi bi-search"></i></button>
                                 </div>
                             </div>
                         </div>
                         <div class="row py-2 mb-2">
                             <div class="col">
                                 <select id="rating-filter" class="form-select form-select-sm" aria-label=".form-select-sm example" style="border-radius: 20px;">
                                     <option value="">Ratings</option>
                                     <option value="5">5 Stars</option>
                                     <option value="4">4 Stars</option>
                                     <option value="3">3 Stars</option>
                                     <option value="2">2 Stars</option>
                                     <option value="1">1 Star</option>
                                 </select>
                             </div>
                             <div class="col">
                                 <select id="classes-filter" class="form-select form-select-sm" aria-label=".form-select-sm example" style="border-radius: 20px;">
                                     <option value="">Classes</option>
                                     <option value="yoga">Yoga</option>
                                     <option value="pilates">Pilates</option>
                                     <option value="zumba">Zumba</option>
                                     <option value="spinning">Spinning</option>
                                     <option value="aerobics">Aerobics</option>
                                 </select>
                             </div>
                             <div class="col">
                                 <select id="amenities-filter" class="form-select form-select-sm" aria-label=".form-select-sm example" style="border-radius: 20px;">
                                     <option value="">Amenities</option>
                                     <option value="pool">Pool</option>
                                     <option value="sauna">Sauna</option>
                                     <option value="steam-room">Steam Room</option>
                                     <option value="group-classes">Group Classes</option>
                                     <option value="personal-training">Personal Training</option>
                             </select>
                             </div>
                           </div>
                           <div class="row py-2 mb-2">
                            <hr class="thick-line">
                            <div class="container" style="height: 500px; overflow-y: scroll;">
                                {% for gym in gyms %}
                                <div class="card mb-3" style="max-width: 540px;">
                                    <div class="row g-0">
                                        <div class="col-md-4">
                                            <a href="#" class="card-link">
                                                {% if gym.img %}
                                                <img src="https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photoreference={{ gym.img }}&key=AIzaSyBS2ButcwA-Kr8IPPJ0ejaO7EdyyblTrnU" class="img-fluid rounded-start card-img-fill" alt="{{gym.name}}">
                                                {% else %}
                                                <img class="img-fluid rounded-start card-img-fill" src="{% static 'img/gym-3.jpg' %}" alt="{{gym.name}}">
                                                {% endif %}
                                            </a>
                                        </div>
                                        <div class="col-md-8">
                                            <div class="card-body">
                                                <a href="#" class="card-link">
                                                    <h5 class="card-title">{{ gym.name }}</h5>
                                                </a>
                                                <p class="card-subtitle mb-2 text-muted">
                                                    <div class="mb-3">
                                                        {{ gym.rating_stars|safe }} <!-- Use safe filter to render HTML content -->
                                                    </div>
                                                </p>
                                                <p class="card-text">{{gym.description}}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-0">
                                        <div class="card-footer bg-transparent">
                                            <div class="row justify-content-between align-items-center">
                                                <div class="col">
                                                    <a href="#" class="btn btn-primary rounded-pill w-100" onclick="showDirections('{{ gym.name }}', '{{ gym.address }}')">
                                                        <i class="fas fa-map-marked-alt me-2"></i> Directions
                                                    </a>
                                                </div>
                                                <div class="col">
                                                    <button type="button" class="btn btn-primary rounded-pill w-100" id="exploreButton">
                                                        <i class="fas fa-binoculars me-2"></i> Explore
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        
                         </div>
                         </div>
                         </div>
                         <div class="col-sm-8 pt-lg-4 mt-lg-4">
                             <div class="container-fliud">
                                 <div class="card" style="height: 520px; border-radius: 10px;">
                                     <div class="card-body">
                                        <!-- Gym details container -->
                                         <div id="gymDetailsContainer">
                                             
                                         </div>
                                     </div>
                                 </div>
                             </div>
                             <!-- Map display ---->
                             <div id="map">
                                
                             </div>
                         </div>
                   </div>
             </div>
         </div>
     </div>
</div>
<script>  
    var locationRetrieved = {% if locationRetrieved %}true{% else %}false{% endif %};
    
    function getLocation() {
    if (locationRetrieved === false) {
        locationRetrieved = true;
        
        if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
        }  
    }
    }
    
    function showPosition(position) {
    var lat = position.coords.latitude;  
    var lng = position.coords.longitude;  
    
    window.location.href = "?lat=" + lat + "&lng=" + lng + "&retrieved=true";
    }
    
    getLocation();
    </script>
    <script>
        function showDirections(name, address) {
          var url = "https://www.google.com/maps/dir/?api=1&destination=" + name + "+" + address;   
          window.open(url, "_blank");   
        }  
        </script>
    
{% endblock content %}